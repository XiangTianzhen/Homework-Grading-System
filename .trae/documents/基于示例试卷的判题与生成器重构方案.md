## 目标
- 以你上传的示例试卷版式为标准，重构“试卷图片生成器”与“判题（识别与评分）”两大模块。
- 统一版式：包含左侧信息栏（镇乡/学校/班级/姓名/考号）、分卷标题、注意事项、分大题（填空/判断/选择/计算/解决问题等）与网格/图表题版式。
- 判题匹配到版式：按模板区域识别答案并按题型规则评分。

## 数据与模板设计
- 新增统一模板数据结构（JSON）：
  - `meta`: 标题、考试时长、总分、注意事项
  - `sidebar`: 左侧栏标签（镇乡/学校/班级/姓名/考号）
  - `sections[]`: 每个大题：`type`（fill/truefalse/single/maths/solve/graph）、`title`、`score_info`、`items[]`
  - `items[]`：题干文本、题号、题型专属字段：
    - `fill`: `blanks`（空数）、`units`（单位）、`answer`（标准答案）
    - `truefalse`: `answer`（true/false）
    - `single`: `options[A-D]`、`answer`（A-D）
    - `maths`: 算式或表达式、`answer`（结果）
    - `solve`: 文字题，`keywords`（评分关键词）
    - `graph`: `grid` 参数（大小/刻度）、或 `barChart` 参数（组名与值）
  - `layout`: 画布尺寸、边距、列宽、网格样式、字体等
- 模板绑定识别区域：为每个 `item` 自动生成区域坐标（Canvas 渲染时可输出 `x,y,w,h`），前端保存为 `templateRegions`，后端根据这些区域做 OCR。

## 生成器重构
- 从模板 JSON 一键绘制：
  - 左侧竖栏：按模板 `sidebar` 渲染，并画分隔线
  - 大题标题：一、二、三…，题号自动对齐
  - `fill`：在等号或空位后按字号自适应画下划线（支持多个空），为每个空生成坐标区域
  - `truefalse`：题末渲染“√/×”选择框或圆点，生成两位标记区域
  - `single`：渲染 A-D 选项，题末绘制作答标记圈位区域
  - `maths`/`solve`：题干下方预留作答区域框，生成坐标
  - `graph`：
    - 网格题：绘制坐标网格（与示例一致刻度），标注坐标轴
    - 条形图题：绘制柱状图（示例风格），并在图下方给出问题
- 导出调试层：可开启“显示区域框”开关，生成时在画布上叠加半透明矩形，便于确认 OCR 区域与题号绑定。
- 4K 与移动端自适应：字号/间距使用 `clamp()`，画布按模板 `layout` 自适应；移动端单列下生成器宽度为屏宽。

## 识别与判题重构
- 流程：图像预处理→按模板区域批量 OCR→题型解析→评分→日志
- 图像预处理（后端）：灰度、对比度提升、噪点滤除；保留当前百度 OCR，但对每个区域进行裁剪后送 OCR。
- 题型解析与评分规则：
  - `fill`: 比较数字/分数/单位；数字允许小阈值误差；分数做约分标准化；单位按模板 `units` 做归一化。
  - `truefalse`: 识别“√/×”（或 ✔/✖），容错相近符号。
  - `single`: 识别圈选字母（A-D）；若圈在选项附近也匹配；容错手写体。
  - `maths`: 以最终结果为准（阶段1）；后续可加过程步评分（关键词/式子匹配）。
  - `solve`: 关键词匹配多点加分；支持数字范围匹配（如“答案100棵”）。
  - `graph`: 坐标题识别坐标填写；条形图题识别数字或字母选项。
- 历史与错题：按题型记录细项评分与错误原因；保存至 `localStorage` 与 `log/` 文件。

## UI 交互调整
- 新增“模板选择/加载”入口：选择示例模板后，生成器按模板生成；评分时使用模板区域。
- 调试工具：
  - “显示区域框”开关（生成器侧）
  - “显示识别文本”面板保留
  - 单题重识别按钮（某题区域失败时重试）

## 日志规范（Windows 本地时区）
- `log/yyyyMMddHHmmss.log`：记录模板ID、每题OCR文字、判题结果、得分与耗时，方便教学与复盘。

## 迭代里程碑
- 阶段1：模板JSON与生成器重构（支持示例试卷五大题型版式；输出区域坐标）
- 阶段2：后端按区域OCR与题型评分；“显示识别文本”按题号分组
- 阶段3：UI：模板选择与调试层；单题重识别；日志落地
- 阶段4：专项容错与数值单位规则完善；条形图/网格题增强

## 文件改动（预估）
- `frontend/src/components/TestImageGenerator.vue`：改为模板驱动渲染、区域坐标输出、调试层开关
- `frontend/src/App.vue`：增加模板选择与评分对接；按题型展示结果
- `frontend/src/api.js`：新增 `recognizeByTemplate(filename, regions)`
- `backend/server.js`：新增按区域批量OCR端点与评分规则（分题型）
- `log/`：新增日志写入
- `README.md`：补充模板使用与调试说明

## 知识点提示
- 不引入新框架，仅基于现有 Vue3 + Express 与百度OCR；算法与数据结构在本项目内实现。

## 请求确认
- 是否按以上方案实施？确认后我将开始编码与联调，并在完成每一阶段后推送到 GitHub 与 Gitee。